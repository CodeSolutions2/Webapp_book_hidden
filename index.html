<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  </head>
  <body>
    
 <input id="auth_id" type="text" value="" placeholder="auth" rows="10" cols="100" style="display:block; text-align: left; width: 150px;">

<button id="PUT_input_to_file" onclick="PUT_input_to_file()" style="display:block">PUT_input_to_file</button>
	
<button id="GET_data_from_file_way0" onclick="GET_data_from_file_way0()" style="display:block">GET_data_from_file_way0</button>
    
<button id="GET_text_from_file" onclick="GET_text_from_file()" style="display:block">GET_text_from_file</button>

<!-- <input type="file" id="text_file_input" accept=".txt"> -->
	  
    
<!-- View results -->
<div id="output" style="font-family:courier;font-size:24px;height:300px"></div>

<script>

// ----------------------------------------------------

const outp = document.getElementById('output');
  
var repoOwner = "CodeSolutions2";
var repoName = "testing_filereader";
var filename = "data.txt";



// ----------------------------------------------------
// Way 0: REST API
// ----------------------------------------------------
async function PUT_input_to_file() {

	const auth = document.getElementById("auth_id").value;

   var message = "add another line to file";
	
   await (await fetch(
    `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filename}`,
    {
      method: 'PUT',
      headers: {
        Accept: 'application/vnd.github+json',
        Authorization: `Bearer ${auth}`
      },
      body: JSON.stringify({
        message: message,
     //   content: btoa(content),
       // sha: existingFile.sha,
      }),
    }
  )).json();

}
  
// ----------------------------------------------------

async function GET_data_from_file_way0() {

const auth = document.getElementById("auth_id").value;

// let url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filename}`;
// let url = "https://api.github.com/repos/CodeSolutions2/testing_filereader/data.txt";
// let url = "https://github.com/CodeSolutions2/testing_filereader/blob/main/data.txt";
let url = await get_txt_dataURL_in_repo();
console.log('url: ', url); // https://raw.githubusercontent.com/CodeSolutions2/testing_filereader/main/data.txt

// For text data: "Content-Type": "application/x-www-form-urlencoded"
// For binary data: "Content-Type": "multipart/form-data"
// For image data: "Content-Type": "image/png", "image/jpg"
// For PUTTING a file to storage: "Content-Type": "application/octet-stream"
	
let headers = {
	//"Content-Type": "application/x-www-form-urlencoded", 
	       Accept: 'application/vnd.github+json',
	       Authorization: `Bearer ${auth}`,
	       "Connection": "keep-alive"};

// Using mode: "no-cors" will give you an opaque response meaning that the body will be empty
let options = {method : 'GET', 
	       headers: headers, 
	       mode: 'same-origin', 
	    //   cache: "no-cache", 
	       credentials: "include", 
	       redirect: "follow", 
	       //referrerPolicy: "origin"
	      };
  
	//const existingFile = await (await fetch(url, options)).json();
	//console.log("existingFile: ", existingFile);
	
	// OR

	// Webscrapping format: it can return html
	// const existingFile1 = await fetch(url, options);
 	// console.log("existingFile1: ", existingFile1);

	// var out = await existingFile1.text();
	// console.log("out: ", out);

	// OR

	//
	await fetch(url, options)
			    .then(function(response) {
			    return response.text();
			    })
			    .then(function(text) {
			    console.log('Request successful', text);
			    })
			    .catch(function(error) {
			    console.log('Request failed', error)
			    });

}


// ----------------------------------------------------


  






// ----------------------------------------------------
// Way 1: FileReader Example
// it reads the file from the Computer
// ----------------------------------------------------
async function create_txt_fileElement() {
  
  const objectType_input = document.createElement('input');
  objectType_input.setAttribute('type', 'file');
  objectType_input.setAttribute('id', 'text-file-input');
  objectType_input.setAttribute('accept', '.txt');
  document.body.appendChild(objectType_input);
}


// document.getElementById('text_file_input').addEventListener('change', processEvent);

async function processEvent(event) {
  const reader = new FileReader();
  const file = event.target.files[0];

  // Print the information in the file to the screen
  reader.onload = function (e) {
    // document.getElementById('output').textContent = e.target.result;
    // OR
    outp.innerHTML += e.target.result;
  }

// A method of the FileReader interface is used to read the contents of the specified Blob or File
  reader.readAsText(file);
}

// ----------------------------------------------------



	


// ----------------------------------------------------
// Way 2: FileReader automatic
// ----------------------------------------------------
async function GET_text_from_file() {

  // Create a input attribute on the document
  //await create_txt_fileElement();

  const reader = new FileReader();
  reader.src = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filename}`

  // Print the information in the file to the screen
  reader.onload = function (e) {
    // document.getElementById('output').textContent = e.target.result;
    // OR
    outp.innerHTML += e.target.result;
  }
	
}



// ----------------------------------------------------


async function get_txt_dataURL_in_repo() {

    var url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents`;

	var url_vec = [];
	await fetch(url).then(res => res.json()).then(data => {
		    data.forEach(file => {
		      if (file.type === 'file' && file.name.match(/.(csv|txt)$/i)) {
			url_vec.push(file.download_url);
		      }
		    });
		  }).catch(error => { outp.innerHTML += error; });

   
	const get_URLblob = url_vec[0];
	
	return get_URLblob;
}


    
// ----------------------------------------------------
  
</script>

  </body>
</html>
