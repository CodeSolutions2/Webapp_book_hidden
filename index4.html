<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  </head>
  <body>
    
<input id="auth_id" type="text" value="" placeholder="auth" rows="10" cols="100" style="display:block; text-align: left; width: 150px;">

<button id="PUT_add_to_a_file_RESTAPI" onclick="PUT_add_to_a_file_RESTAPI()" style="display:block">PUT_add_to_a_file_RESTAPI</button>

<button id="PUT_create_a_file_RESTAPI" onclick="PUT_create_a_file_RESTAPI()" style="display:block">PUT_create_a_file_RESTAPI</button>

<button id="GET_text_from_file_RESTAPI" onclick="func2()" style="display:block">GET_text_from_file_RESTAPI</button>
	  
<button id="GET_repo_file_info_RESTAPI" onclick="GET_repo_file_info_RESTAPI()" style="display:block">GET_repo_file_info_RESTAPI</button>
 
<!-- <input type="file" id="text_file_input" accept=".txt"> -->
	  
    
<!-- View results -->
<div id="output" style="font-family:courier;font-size:24px;height:300px"></div>


<script>

// ----------------------------------------------------

const outp = document.getElementById('output');
  
var repoOwner = "CodeSolutions2";
var repoName = "testing_filereader";
var filename = "data.txt";

	
	
// ----------------------------------------------------
// PUT add to an existing file - Way 0: REST API
// Can only write to a public repository, can not write to a private repository even if the key grants access
// https://docs.github.com/en/rest/repos/contents?apiVersion=2022-11-28#create-or-update-file-contents
// ----------------------------------------------------
async function PUT_add_to_a_file_RESTAPI() {

   const auth = document.getElementById("auth_id").value;
   var message = "a new commit message";
   var content = 'add another line to file\n';

   // https://developer.mozilla.org/en-US/docs/Web/API/btoa
   var content_encoded0 = btoa(content);
   console.log("content_encoded0: ", content_encoded0);

   // PUT into an existing file
   var url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filename}`;
   return await fetch(url).then(res => res.json()).then(data => {
	   let sha_val = data.sha; console.log('sha_val: ', sha_val); return sha_val; })
	   .then(async function (sha_val) { 
		   var data = {"message": message, "committer":{"name":"App name","email":"App email"}, "content": content_encoded0, "sha": sha_val};
		   var headers = {"Accept": "application/vnd.github+json", "Authorization": `Bearer ${auth}`, "X-GitHub-Api-Version": "2022-11-28"};
		   var options = {method : 'PUT', headers: headers, body : JSON.stringify(data)};
		   var out = await fetch(url, options); return out; })
	   		.then(res => { console.log(res); } )
	   		.catch(error => { console.log(error); });

}



	
// ----------------------------------------------------
// PUT create a file - Way 0: REST API (WORKS!)
// Can only write to a public repository, can not write to a private repository even if the key grants access
// https://docs.github.com/en/rest/repos/contents?apiVersion=2022-11-28#create-or-update-file-contents
// ----------------------------------------------------
async function PUT_create_a_file_RESTAPI() {

   const auth = document.getElementById("auth_id").value;
   var message = "a new commit message";
   var content = 'add another line to file\n';

   // https://developer.mozilla.org/en-US/docs/Web/API/btoa
   var content_encoded0 = btoa(content);
   console.log("content_encoded0: ", content_encoded0);

// PUT into a new file
var url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/data_040424.txt`;
var data = {"message": message, "committer":{"name":"App name","email":"App email"}, "content": content_encoded0};
var headers = {"Accept": "application/vnd.github+json", "Authorization": `Bearer ${auth}`, "X-GitHub-Api-Version": "2022-11-28"};
var options = {method : 'PUT', headers: headers, body : JSON.stringify(data)};
return await fetch(url, options)
		.then(res => { console.log(res); return res; })
		.catch(error => { console.log(error); });

}
  
// ----------------------------------------------------

	

// ----------------------------------------------------
// GET data in a file - Way 0: REST API (WORKS!)
// https://docs.github.com/en/rest/repos/contents?apiVersion=2022-11-28#get-repository-content
// ----------------------------------------------------
async function GET_text_from_file_RESTAPI() {

	const auth = document.getElementById("auth_id").value;
	
	var url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filename}`;

	var headers = {"Accept": "application/vnd.github+json", "Authorization": `Bearer ${auth}`, "X-GitHub-Api-Version": "2022-11-28"}
	var options = {method : 'GET', headers: headers};
	
	return await fetch(url, options).then(res => res.json())
		.then(data => { 
			// console.log('data: ', data); 
			return data; })
		.catch(error => { console.log(error); });
}

async function func2() {
	await GET_text_from_file_RESTAPI()
		.then(data => {console.log('data.content: ', data.content); 
			var content_decoded0 = atob(data.content);
   console.log("content_decoded0: ", content_decoded0);
			});
	
}
	
// ----------------------------------------------------


	

// ----------------------------------------------------
// GET information about files in a repository - Way 0: REST API (WORKS!)
// ----------------------------------------------------
async function GET_repo_file_info_RESTAPI() {

	var url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents`;
	
	return await fetch(url).then(res => res.json()).then(data => {
	console.log('data: ', data);
	// data contains: { self: "https://api.github.com/repos/CodeSolutions2/testing_filereader/contents/data.txt?ref=main", 
	// git: "https://api.github.com/repos/CodeSolutions2/testing_filereader/git/blobs/c4889a157c4ca8945b75a0c1b00c84c2f6d448de", 
	// html: "https://github.com/CodeSolutions2/testing_filereader/blob/main/data.txt" }
	// download_url: "https://raw.githubusercontent.com/CodeSolutions2/testing_filereader/main/data.txt"
	// git_url: "https://api.github.com/repos/CodeSolutions2/testing_filereader/git/blobs/c4889a157c4ca8945b75a0c1b00c84c2f6d448de"
	// html_url: "https://github.com/CodeSolutions2/testing_filereader/blob/main/data.txt"
	// name: "data.txt"
	// path: "data.txt"
	// sha: "c4889a157c4ca8945b75a0c1b00c84c2f6d448de"
	// size: 60
	// type: "file"
	// url: "https://api.github.com/repos/CodeSolutions2/testing_filereader/contents/data.txt?ref=main"
	return data; });
}
	
// ----------------------------------------------------


  
</script>

  </body>
</html>
